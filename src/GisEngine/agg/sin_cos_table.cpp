#include "stdafx.h"
#include "sin_cos_table.h"
#include <assert.h>
#include <vector>
#include <algorithm>
#include <functional>

namespace agg
{

  static const long sin_val[] = {
    0, /*   0:      0.00 */ 
    175, /*   1:    174.52 */ 
    349, /*   2:    348.99 */ 
    523, /*   3:    523.36 */ 
    698, /*   4:    697.56 */ 
    872, /*   5:    871.56 */ 
    1045, /*   6:   1045.28 */ 
    1219, /*   7:   1218.69 */ 
    1392, /*   8:   1391.73 */ 
    1564, /*   9:   1564.34 */ 
    1736, /*  10:   1736.48 */ 
    1908, /*  11:   1908.09 */ 
    2079, /*  12:   2079.12 */ 
    2250, /*  13:   2249.51 */ 
    2419, /*  14:   2419.22 */ 
    2588, /*  15:   2588.19 */ 
    2756, /*  16:   2756.37 */ 
    2924, /*  17:   2923.72 */ 
    3090, /*  18:   3090.17 */ 
    3256, /*  19:   3255.68 */ 
    3420, /*  20:   3420.20 */ 
    3584, /*  21:   3583.68 */ 
    3746, /*  22:   3746.07 */ 
    3907, /*  23:   3907.31 */ 
    4067, /*  24:   4067.37 */ 
    4226, /*  25:   4226.18 */ 
    4384, /*  26:   4383.71 */ 
    4540, /*  27:   4539.90 */ 
    4695, /*  28:   4694.72 */ 
    4848, /*  29:   4848.10 */ 
    5000, /*  30:   5000.00 */ 
    5150, /*  31:   5150.38 */ 
    5299, /*  32:   5299.19 */ 
    5446, /*  33:   5446.39 */ 
    5592, /*  34:   5591.93 */ 
    5736, /*  35:   5735.76 */ 
    5878, /*  36:   5877.85 */ 
    6018, /*  37:   6018.15 */ 
    6157, /*  38:   6156.61 */ 
    6293, /*  39:   6293.20 */ 
    6428, /*  40:   6427.88 */ 
    6561, /*  41:   6560.59 */ 
    6691, /*  42:   6691.31 */ 
    6820, /*  43:   6819.98 */ 
    6947, /*  44:   6946.58 */ 
    7071, /*  45:   7071.07 */ 
    7193, /*  46:   7193.40 */ 
    7314, /*  47:   7313.54 */ 
    7431, /*  48:   7431.45 */ 
    7547, /*  49:   7547.10 */ 
    7660, /*  50:   7660.44 */ 
    7771, /*  51:   7771.46 */ 
    7880, /*  52:   7880.11 */ 
    7986, /*  53:   7986.36 */ 
    8090, /*  54:   8090.17 */ 
    8192, /*  55:   8191.52 */ 
    8290, /*  56:   8290.38 */ 
    8387, /*  57:   8386.71 */ 
    8480, /*  58:   8480.48 */ 
    8572, /*  59:   8571.67 */ 
    8660, /*  60:   8660.25 */ 
    8746, /*  61:   8746.20 */ 
    8829, /*  62:   8829.48 */ 
    8910, /*  63:   8910.07 */ 
    8988, /*  64:   8987.94 */ 
    9063, /*  65:   9063.08 */ 
    9135, /*  66:   9135.45 */ 
    9205, /*  67:   9205.05 */ 
    9272, /*  68:   9271.84 */ 
    9336, /*  69:   9335.80 */ 
    9397, /*  70:   9396.93 */ 
    9455, /*  71:   9455.19 */ 
    9511, /*  72:   9510.57 */ 
    9563, /*  73:   9563.05 */ 
    9613, /*  74:   9612.62 */ 
    9659, /*  75:   9659.26 */ 
    9703, /*  76:   9702.96 */ 
    9744, /*  77:   9743.70 */ 
    9781, /*  78:   9781.48 */ 
    9816, /*  79:   9816.27 */ 
    9848, /*  80:   9848.08 */ 
    9877, /*  81:   9876.88 */ 
    9903, /*  82:   9902.68 */ 
    9925, /*  83:   9925.46 */ 
    9945, /*  84:   9945.22 */ 
    9962, /*  85:   9961.95 */ 
    9976, /*  86:   9975.64 */ 
    9986, /*  87:   9986.30 */ 
    9994, /*  88:   9993.91 */ 
    9998, /*  89:   9998.48 */ 
    10000, /*  90:  10000.00 */ 
    9998, /*  91:   9998.48 */ 
    9994, /*  92:   9993.91 */ 
    9986, /*  93:   9986.30 */ 
    9976, /*  94:   9975.64 */ 
    9962, /*  95:   9961.95 */ 
    9945, /*  96:   9945.22 */ 
    9925, /*  97:   9925.46 */ 
    9903, /*  98:   9902.68 */ 
    9877, /*  99:   9876.88 */ 
    9848, /* 100:   9848.08 */ 
    9816, /* 101:   9816.27 */ 
    9781, /* 102:   9781.48 */ 
    9744, /* 103:   9743.70 */ 
    9703, /* 104:   9702.96 */ 
    9659, /* 105:   9659.26 */ 
    9613, /* 106:   9612.62 */ 
    9563, /* 107:   9563.05 */ 
    9511, /* 108:   9510.57 */ 
    9455, /* 109:   9455.19 */ 
    9397, /* 110:   9396.93 */ 
    9336, /* 111:   9335.80 */ 
    9272, /* 112:   9271.84 */ 
    9205, /* 113:   9205.05 */ 
    9135, /* 114:   9135.45 */ 
    9063, /* 115:   9063.08 */ 
    8988, /* 116:   8987.94 */ 
    8910, /* 117:   8910.07 */ 
    8829, /* 118:   8829.48 */ 
    8746, /* 119:   8746.20 */ 
    8660, /* 120:   8660.25 */ 
    8572, /* 121:   8571.67 */ 
    8480, /* 122:   8480.48 */ 
    8387, /* 123:   8386.71 */ 
    8290, /* 124:   8290.38 */ 
    8192, /* 125:   8191.52 */ 
    8090, /* 126:   8090.17 */ 
    7986, /* 127:   7986.36 */ 
    7880, /* 128:   7880.11 */ 
    7771, /* 129:   7771.46 */ 
    7660, /* 130:   7660.44 */ 
    7547, /* 131:   7547.10 */ 
    7431, /* 132:   7431.45 */ 
    7314, /* 133:   7313.54 */ 
    7193, /* 134:   7193.40 */ 
    7071, /* 135:   7071.07 */ 
    6947, /* 136:   6946.58 */ 
    6820, /* 137:   6819.98 */ 
    6691, /* 138:   6691.31 */ 
    6561, /* 139:   6560.59 */ 
    6428, /* 140:   6427.88 */ 
    6293, /* 141:   6293.20 */ 
    6157, /* 142:   6156.61 */ 
    6018, /* 143:   6018.15 */ 
    5878, /* 144:   5877.85 */ 
    5736, /* 145:   5735.76 */ 
    5592, /* 146:   5591.93 */ 
    5446, /* 147:   5446.39 */ 
    5299, /* 148:   5299.19 */ 
    5150, /* 149:   5150.38 */ 
    5000, /* 150:   5000.00 */ 
    4848, /* 151:   4848.10 */ 
    4695, /* 152:   4694.72 */ 
    4540, /* 153:   4539.90 */ 
    4384, /* 154:   4383.71 */ 
    4226, /* 155:   4226.18 */ 
    4067, /* 156:   4067.37 */ 
    3907, /* 157:   3907.31 */ 
    3746, /* 158:   3746.07 */ 
    3584, /* 159:   3583.68 */ 
    3420, /* 160:   3420.20 */ 
    3256, /* 161:   3255.68 */ 
    3090, /* 162:   3090.17 */ 
    2924, /* 163:   2923.72 */ 
    2756, /* 164:   2756.37 */ 
    2588, /* 165:   2588.19 */ 
    2419, /* 166:   2419.22 */ 
    2250, /* 167:   2249.51 */ 
    2079, /* 168:   2079.12 */ 
    1908, /* 169:   1908.09 */ 
    1736, /* 170:   1736.48 */ 
    1564, /* 171:   1564.34 */ 
    1392, /* 172:   1391.73 */ 
    1219, /* 173:   1218.69 */ 
    1045, /* 174:   1045.28 */ 
    872, /* 175:    871.56 */ 
    698, /* 176:    697.56 */ 
    523, /* 177:    523.36 */ 
    349, /* 178:    348.99 */ 
    175, /* 179:    174.52 */ 
    0, /* 180:      0.00 */ 
    -175, /* 181:   -174.52 */ 
    -349, /* 182:   -348.99 */ 
    -523, /* 183:   -523.36 */ 
    -698, /* 184:   -697.56 */ 
    -872, /* 185:   -871.56 */ 
    -1045, /* 186:  -1045.28 */ 
    -1219, /* 187:  -1218.69 */ 
    -1392, /* 188:  -1391.73 */ 
    -1564, /* 189:  -1564.34 */ 
    -1736, /* 190:  -1736.48 */ 
    -1908, /* 191:  -1908.09 */ 
    -2079, /* 192:  -2079.12 */ 
    -2250, /* 193:  -2249.51 */ 
    -2419, /* 194:  -2419.22 */ 
    -2588, /* 195:  -2588.19 */ 
    -2756, /* 196:  -2756.37 */ 
    -2924, /* 197:  -2923.72 */ 
    -3090, /* 198:  -3090.17 */ 
    -3256, /* 199:  -3255.68 */ 
    -3420, /* 200:  -3420.20 */ 
    -3584, /* 201:  -3583.68 */ 
    -3746, /* 202:  -3746.07 */ 
    -3907, /* 203:  -3907.31 */ 
    -4067, /* 204:  -4067.37 */ 
    -4226, /* 205:  -4226.18 */ 
    -4384, /* 206:  -4383.71 */ 
    -4540, /* 207:  -4539.90 */ 
    -4695, /* 208:  -4694.72 */ 
    -4848, /* 209:  -4848.10 */ 
    -5000, /* 210:  -5000.00 */ 
    -5150, /* 211:  -5150.38 */ 
    -5299, /* 212:  -5299.19 */ 
    -5446, /* 213:  -5446.39 */ 
    -5592, /* 214:  -5591.93 */ 
    -5736, /* 215:  -5735.76 */ 
    -5878, /* 216:  -5877.85 */ 
    -6018, /* 217:  -6018.15 */ 
    -6157, /* 218:  -6156.61 */ 
    -6293, /* 219:  -6293.20 */ 
    -6428, /* 220:  -6427.88 */ 
    -6561, /* 221:  -6560.59 */ 
    -6691, /* 222:  -6691.31 */ 
    -6820, /* 223:  -6819.98 */ 
    -6947, /* 224:  -6946.58 */ 
    -7071, /* 225:  -7071.07 */ 
    -7193, /* 226:  -7193.40 */ 
    -7314, /* 227:  -7313.54 */ 
    -7431, /* 228:  -7431.45 */ 
    -7547, /* 229:  -7547.10 */ 
    -7660, /* 230:  -7660.44 */ 
    -7771, /* 231:  -7771.46 */ 
    -7880, /* 232:  -7880.11 */ 
    -7986, /* 233:  -7986.36 */ 
    -8090, /* 234:  -8090.17 */ 
    -8192, /* 235:  -8191.52 */ 
    -8290, /* 236:  -8290.38 */ 
    -8387, /* 237:  -8386.71 */ 
    -8480, /* 238:  -8480.48 */ 
    -8572, /* 239:  -8571.67 */ 
    -8660, /* 240:  -8660.25 */ 
    -8746, /* 241:  -8746.20 */ 
    -8829, /* 242:  -8829.48 */ 
    -8910, /* 243:  -8910.07 */ 
    -8988, /* 244:  -8987.94 */ 
    -9063, /* 245:  -9063.08 */ 
    -9135, /* 246:  -9135.45 */ 
    -9205, /* 247:  -9205.05 */ 
    -9272, /* 248:  -9271.84 */ 
    -9336, /* 249:  -9335.80 */ 
    -9397, /* 250:  -9396.93 */ 
    -9455, /* 251:  -9455.19 */ 
    -9511, /* 252:  -9510.57 */ 
    -9563, /* 253:  -9563.05 */ 
    -9613, /* 254:  -9612.62 */ 
    -9659, /* 255:  -9659.26 */ 
    -9703, /* 256:  -9702.96 */ 
    -9744, /* 257:  -9743.70 */ 
    -9781, /* 258:  -9781.48 */ 
    -9816, /* 259:  -9816.27 */ 
    -9848, /* 260:  -9848.08 */ 
    -9877, /* 261:  -9876.88 */ 
    -9903, /* 262:  -9902.68 */ 
    -9925, /* 263:  -9925.46 */ 
    -9945, /* 264:  -9945.22 */ 
    -9962, /* 265:  -9961.95 */ 
    -9976, /* 266:  -9975.64 */ 
    -9986, /* 267:  -9986.30 */ 
    -9994, /* 268:  -9993.91 */ 
    -9998, /* 269:  -9998.48 */ 
    -10000, /* 270: -10000.00 */ 
    -9998, /* 271:  -9998.48 */ 
    -9994, /* 272:  -9993.91 */ 
    -9986, /* 273:  -9986.30 */ 
    -9976, /* 274:  -9975.64 */ 
    -9962, /* 275:  -9961.95 */ 
    -9945, /* 276:  -9945.22 */ 
    -9925, /* 277:  -9925.46 */ 
    -9903, /* 278:  -9902.68 */ 
    -9877, /* 279:  -9876.88 */ 
    -9848, /* 280:  -9848.08 */ 
    -9816, /* 281:  -9816.27 */ 
    -9781, /* 282:  -9781.48 */ 
    -9744, /* 283:  -9743.70 */ 
    -9703, /* 284:  -9702.96 */ 
    -9659, /* 285:  -9659.26 */ 
    -9613, /* 286:  -9612.62 */ 
    -9563, /* 287:  -9563.05 */ 
    -9511, /* 288:  -9510.57 */ 
    -9455, /* 289:  -9455.19 */ 
    -9397, /* 290:  -9396.93 */ 
    -9336, /* 291:  -9335.80 */ 
    -9272, /* 292:  -9271.84 */ 
    -9205, /* 293:  -9205.05 */ 
    -9135, /* 294:  -9135.45 */ 
    -9063, /* 295:  -9063.08 */ 
    -8988, /* 296:  -8987.94 */ 
    -8910, /* 297:  -8910.07 */ 
    -8829, /* 298:  -8829.48 */ 
    -8746, /* 299:  -8746.20 */ 
    -8660, /* 300:  -8660.25 */ 
    -8572, /* 301:  -8571.67 */ 
    -8480, /* 302:  -8480.48 */ 
    -8387, /* 303:  -8386.71 */ 
    -8290, /* 304:  -8290.38 */ 
    -8192, /* 305:  -8191.52 */ 
    -8090, /* 306:  -8090.17 */ 
    -7986, /* 307:  -7986.36 */ 
    -7880, /* 308:  -7880.11 */ 
    -7771, /* 309:  -7771.46 */ 
    -7660, /* 310:  -7660.44 */ 
    -7547, /* 311:  -7547.10 */ 
    -7431, /* 312:  -7431.45 */ 
    -7314, /* 313:  -7313.54 */ 
    -7193, /* 314:  -7193.40 */ 
    -7071, /* 315:  -7071.07 */ 
    -6947, /* 316:  -6946.58 */ 
    -6820, /* 317:  -6819.98 */ 
    -6691, /* 318:  -6691.31 */ 
    -6561, /* 319:  -6560.59 */ 
    -6428, /* 320:  -6427.88 */ 
    -6293, /* 321:  -6293.20 */ 
    -6157, /* 322:  -6156.61 */ 
    -6018, /* 323:  -6018.15 */ 
    -5878, /* 324:  -5877.85 */ 
    -5736, /* 325:  -5735.76 */ 
    -5592, /* 326:  -5591.93 */ 
    -5446, /* 327:  -5446.39 */ 
    -5299, /* 328:  -5299.19 */ 
    -5150, /* 329:  -5150.38 */ 
    -5000, /* 330:  -5000.00 */ 
    -4848, /* 331:  -4848.10 */ 
    -4695, /* 332:  -4694.72 */ 
    -4540, /* 333:  -4539.90 */ 
    -4384, /* 334:  -4383.71 */ 
    -4226, /* 335:  -4226.18 */ 
    -4067, /* 336:  -4067.37 */ 
    -3907, /* 337:  -3907.31 */ 
    -3746, /* 338:  -3746.07 */ 
    -3584, /* 339:  -3583.68 */ 
    -3420, /* 340:  -3420.20 */ 
    -3256, /* 341:  -3255.68 */ 
    -3090, /* 342:  -3090.17 */ 
    -2924, /* 343:  -2923.72 */ 
    -2756, /* 344:  -2756.37 */ 
    -2588, /* 345:  -2588.19 */ 
    -2419, /* 346:  -2419.22 */ 
    -2250, /* 347:  -2249.51 */ 
    -2079, /* 348:  -2079.12 */ 
    -1908, /* 349:  -1908.09 */ 
    -1736, /* 350:  -1736.48 */ 
    -1564, /* 351:  -1564.34 */ 
    -1392, /* 352:  -1391.73 */ 
    -1219, /* 353:  -1218.69 */ 
    -1045, /* 354:  -1045.28 */ 
    -872, /* 355:   -871.56 */ 
    -698, /* 356:   -697.56 */ 
    -523, /* 357:   -523.36 */ 
    -349, /* 358:   -348.99 */ 
    -175 /* 359:   -174.52 */ 
  };

  
  //BOOST_STATIC_ASSERT(360 == (sizeof(sin_val) / sizeof(sin_val[0])));

  long sin_long (long grad)
  {
    grad += 360;
    grad %= 360;
    assert (grad >=0 && grad < 360);
    return sin_val[grad];
  }

  double sin_double (long grad)
  {
    return sin_long(grad) / 10000.;
  }

  long cos_long (long grad)
  {
    return sin_long(grad + 90);
  }

  double cos_double (long grad)
  {
    return cos_long(grad) / 10000.;
  }

static long bsearch_asin (long val)
{
  static long const * const begin = sin_val + 90;
  static long const * const end = sin_val + 270;
  const long *p = std::lower_bound(begin, end, val, std::greater<long>());
  assert((p == begin) || (p == end) || (val >= *p));
  // если найдено begin - то нужно возвращаеть его (даже если val > *begin, все равно ничего лучшего не найдется ;))
  // если же расстояние до предыдущего отсчета меньше, чем до найденного - лучше вернуть предыдущий, точнее получится
  // в случае p == end второе условие работает правильно даже в случае val < *end
  if ((p > begin) && ((val - p[0]) > (p[-1] - val)))
  {
    --p;
  }
  return static_cast<long>(p - sin_val);
}


long asin_long (long val)
{
  assert (val >= -10000 && val <= 10000);
  return 180 - bsearch_asin (val);
}


long acos_long (long val)
{
  assert (val >= -10000 && val <= 10000);
  return bsearch_asin(val) - 90;
}

}